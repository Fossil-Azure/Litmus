<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sheet Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .card {
      border: 1px solid #ccc;
      padding: 15px;
      margin: 10px;
      display: inline-block;
      width: 250px;
      vertical-align: top;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .card.selected {
      border: 2px solid #007BFF;
      background-color: #f0f8ff;
    }

    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 6px;
    }

    #emailForm {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #eee;
      border-radius: 8px;
      max-width: 500px;
    }

    #emailForm input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }

    #emailForm button {
      padding: 10px 20px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #emailForm button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>

  <h1>Google Sheet Item Selector</h1>
  <div id="cardContainer"></div>

  <div id="emailForm" style="display: none;">
    <h3>Update Email(s) and URL(s):</h3>
    <input type="text" id="emailInput" placeholder="Email(s), comma-separated" />
    <input type="text" id="urlInput" placeholder="URL(s), comma-separated" />
    <button id="submitBtn">Submit</button>
  </div>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbzKUr8RX_Q9e2iZBENMyIaOQ6lT84icRt8bHMLDZNO0n7lk_oINJJV8cxYmP__7wivfmg/exec"; // ← Replace this
    let selectedSKU = null;
    let allItems = [];

    async function loadItems() {
      try {
        const response = await fetch(scriptUrl);
        const data = await response.json();
        allItems = data.items;

        const container = document.getElementById("cardContainer");
        container.innerHTML = "";

        allItems.forEach(item => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img src="${item.image}" alt="Image" />
            <p><strong>Brand:</strong> ${item.brand}</p>
            <p><strong>SKU:</strong> ${item.sku}</p>
            <p><strong>Campaign:</strong> ${item.campaign}</p>
          `;

          card.addEventListener("click", () => {
            document.querySelectorAll(".card").forEach(c => c.classList.remove("selected"));
            card.classList.add("selected");

            selectedSKU = item.sku;
            document.getElementById("emailForm").style.display = "block";
            document.getElementById("emailInput").value = item.email || "";
            document.getElementById("urlInput").value = item.url || "";
          });

          container.appendChild(card);
        });
      } catch (err) {
        console.error("Error loading items:", err);
        alert("Could not load items. Make sure your script is deployed as Web App and shared publicly.");
      }
    }

    document.getElementById("submitBtn").onclick = async () => {
      const email = document.getElementById("emailInput").value.trim();
      const url = document.getElementById("urlInput").value.trim();

      if (!selectedSKU || !email) {
        alert("Please select an item and enter at least one email.");
        return;
      }

      try {
        await fetch(scriptUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ sku: selectedSKU, email, url }),
        });

        alert("Submitted successfully!");
        document.getElementById("emailInput").value = "";
        document.getElementById("urlInput").value = "";
        document.getElementById("emailForm").style.display = "none";
        document.querySelectorAll(".card").forEach(c => c.classList.remove("selected"));

        loadItems(); // Refresh data
      } catch (err) {
        console.error("Submission failed:", err);
        alert("Submission failed. Check browser console for details.");
      }
    };

    loadItems();
  </script>
</body>
</html>
