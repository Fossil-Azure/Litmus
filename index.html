<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Litmus Viewer</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    select, input, textarea, button { margin: 10px 0; padding: 8px; width: 100%; }
    img { max-width: 200px; margin-top: 10px; }
    .container { max-width: 600px; margin: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Litmus Image Sheet Viewer</h2>

    <label>Select Sheet:</label>
    <select id="sheetSelector">
      <option value="Litmus-JP">Litmus-JP</option>
      <option value="Litmus-AU">Litmus-AU</option>
      <option value="Litmus-IN">Litmus-IN</option>
      <option value="Litmus-SGMY">Litmus-SGMY</option>
    </select>

    <label>Select SKU:</label>
    <select id="skuDropdown"></select>

    <div id="imagePreview"></div>

    <label>Email (comma separated):</label>
    <textarea id="emailInput" rows="2"></textarea>

    <label>URLs (comma separated):</label>
    <textarea id="urlInput" rows="2"></textarea>

    <button onclick="submitData()">Submit</button>
  </div>

  <script>
    const baseURL = 'https://script.google.com/macros/s/AKfycbyj_NPgIyRPljFMRFlX6YcWsgsFyQWbedgW1SVos9yqIuWD7eVYY_eBc9Fg812_gKCMag/exec';
    let currentSheetData = [];

    const sheetSelector = document.getElementById('sheetSelector');
    const skuDropdown = document.getElementById('skuDropdown');
    const emailInput = document.getElementById('emailInput');
    const urlInput = document.getElementById('urlInput');
    const imagePreview = document.getElementById('imagePreview');

    sheetSelector.addEventListener('change', loadSheet);
    skuDropdown.addEventListener('change', showImageForSelectedSKU);

    function loadSheet() {
      const sheet = sheetSelector.value;
      fetch(`${baseURL}?sheet=${sheet}`)
        .then(response => {
          if (!response.ok || !response.headers.get("content-type")?.includes("application/json")) {
            return response.text().then(text => { throw new Error(text); });
          }
          return response.json();
        })
        .then(data => {
          currentSheetData = data;
          populateSKUs(data);
        })
        .catch(err => {
          alert("Error: " + err.message);
        });
    }

    function populateSKUs(data) {
      skuDropdown.innerHTML = '';
      data.forEach(row => {
        const option = document.createElement('option');
        option.value = row.SKU;
        option.textContent = row.SKU;
        skuDropdown.appendChild(option);
      });
      showImageForSelectedSKU();
    }

    function showImageForSelectedSKU() {
      const sku = skuDropdown.value;
      const selected = currentSheetData.find(item => item.SKU === sku);
      if (selected) {
        imagePreview.innerHTML = `
          <strong>Brand:</strong> ${selected.Brand}<br/>
          <img src="${selected.Url}" alt="Selected Image"/>
        `;
        emailInput.value = selected.Email || '';
        urlInput.value = selected.Url || '';
      }
    }

    function submitData() {
      const sku = skuDropdown.value;
      const sheet = sheetSelector.value;
      const email = emailInput.value.trim();
      const url = urlInput.value.trim();

      if (!email || !url) {
        alert("Please enter both email and URL.");
        return;
      }

      fetch(baseURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sku, sheet, email, url })
      })
      .then(res => res.text())
      .then(msg => {
        alert("Updated successfully.");
        loadSheet(); // refresh to show updates
      })
      .catch(err => {
        alert("Error submitting: " + err.message);
      });
    }

    // Initial load
    loadSheet();
  </script>
</body>
</html>
